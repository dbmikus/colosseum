
<!-- saved from url=(0069)http://webrtc.googlecode.com/svn/trunk/samples/js/demos/html/pc1.html -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;title&gt;</span>PeerConnection Demo 1<span class="webkit-html-tag">&lt;/title&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-comment">&lt;!-- Load the polyfill to switch-hit between Chrome and Firefox --&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://webrtc.googlecode.com/svn/trunk/samples/js/base/adapter.js">../../base/adapter.js</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;style&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">video {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  border:5px solid black;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  width:480px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  height:360px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">button {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  font: 18px sans-serif;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  padding: 8px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">textarea {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  font-family: monospace;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  margin: 2px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  width:480px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  height:640px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/style&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;video <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">vid1</span>" <span class="webkit-html-attribute-name">autoplay</span>="<span class="webkit-html-attribute-value">true</span>" <span class="webkit-html-attribute-name">muted</span>="<span class="webkit-html-attribute-value">true</span>"&gt;</span><span class="webkit-html-tag">&lt;/video&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;video <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">vid2</span>" <span class="webkit-html-attribute-name">autoplay</span>&gt;</span><span class="webkit-html-tag">&lt;/video&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;br&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;button <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">btn1</span>" <span class="webkit-html-attribute-name">onclick</span>="<span class="webkit-html-attribute-value">start()</span>"&gt;</span>Start<span class="webkit-html-tag">&lt;/button&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;button <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">btn2</span>" <span class="webkit-html-attribute-name">onclick</span>="<span class="webkit-html-attribute-value">call()</span>"&gt;</span>Call<span class="webkit-html-tag">&lt;/button&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;button <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">btn3</span>" <span class="webkit-html-attribute-name">onclick</span>="<span class="webkit-html-attribute-value">hangup()</span>"&gt;</span>Hang Up<span class="webkit-html-tag">&lt;/button&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;br&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;xtextarea <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">ta1</span>"&gt;</span><span class="webkit-html-tag">&lt;/textarea&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;xtextarea <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">ta2</span>"&gt;</span><span class="webkit-html-tag">&lt;/textarea&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">//var vid1 = document.getElementById("vid1");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">//var vid2 = document.getElementById("vid2");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">btn1.disabled = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">btn2.disabled = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">btn3.disabled = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var pc1,pc2;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var localstream;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var sdpConstraints = {'mandatory': {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                        'OfferToReceiveAudio':true, </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                        'OfferToReceiveVideo':true }};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function gotStream(stream){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Received local stream");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  // Call the polyfill wrapper to attach the media stream to this element.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  attachMediaStream(vid1, stream);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  localstream = stream;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn2.disabled = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function start() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Requesting local stream");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn1.disabled = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  // Call into getUserMedia via the polyfill (adapter.js).</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  getUserMedia({audio:true, video:true},</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">                gotStream, function() {});</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}  </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function call() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn2.disabled = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn3.disabled = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Starting call");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  videoTracks = localstream.getVideoTracks();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  audioTracks = localstream.getAudioTracks();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  if (videoTracks.length &gt; 0)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    trace('Using Video device: ' + videoTracks[0].label);  </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  if (audioTracks.length &gt; 0)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    trace('Using Audio device: ' + audioTracks[0].label);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  var servers = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1 = new RTCPeerConnection(servers);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Created local peer connection object pc1");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.onicecandidate = iceCallback1; </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2 = new RTCPeerConnection(servers);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Created remote peer connection object pc2");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.onicecandidate = iceCallback2;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.onaddstream = gotRemoteStream; </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.addStream(localstream);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Adding Local Stream to peer connection");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.createOffer(gotDescription1);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function gotDescription1(desc){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.setLocalDescription(desc);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Offer from pc1 \n" + desc.sdp);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.setRemoteDescription(desc);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  // Since the "remote" side has no media stream we need</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  // to pass in the right constraints in order for it to</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  // accept the incoming offer of audio and video.</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.createAnswer(gotDescription2, null, sdpConstraints);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function gotDescription2(desc){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.setLocalDescription(desc);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Answer from pc2 \n" + desc.sdp);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.setRemoteDescription(desc);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function hangup() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Ending call");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1.close(); </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2.close();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc1 = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  pc2 = null;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn3.disabled = true;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  btn2.disabled = false;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function gotRemoteStream(e){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  vid2.src = webkitURL.createObjectURL(e.stream);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  trace("Received remote stream");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function iceCallback1(event){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  if (event.candidate) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    pc2.addIceCandidate(new RTCIceCandidate(event.candidate));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    trace("Local ICE candidate: \n" + event.candidate.candidate);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      </td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function iceCallback2(event){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  if (event.candidate) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    pc1.addIceCandidate(new RTCIceCandidate(event.candidate));</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    trace("Remote ICE candidate: \n " + event.candidate.candidate);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"></td></tr></tbody></table></body></html>